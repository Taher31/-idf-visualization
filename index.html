<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDF Curves</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Intensity-Duration-Frequency (IDF) Curves</h2>
    <input type="file" id="fileInput" />
    <canvas id="idfChart"></canvas>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    processCSV(text);
                };
                reader.readAsText(file);
            }
        });

        function processCSV(csvText) {
            const lines = csvText.split("\n");
            const data = lines.slice(1).map(line => line.split(","));
            
            const durations = [...new Set(data.map(row => parseInt(row[1])))].sort((a, b) => a - b);
            const returnPeriods = [...new Set(data.map(row => parseInt(row[0])))].sort((a, b) => a - b);

            const idfData = {};
            returnPeriods.forEach(rp => idfData[rp] = []);
            
            data.forEach(row => {
                const duration = parseInt(row[1]);
                const rp = parseInt(row[0]);
                const intensity = parseFloat(row[2]);
                idfData[rp].push({ x: duration, y: intensity });
            });

            plotIDF(idfData);
        }

        function plotIDF(idfData) {
            const ctx = document.getElementById('idfChart').getContext('2d');
            const datasets = Object.keys(idfData).map(rp => ({
                label: `RP ${rp} years`,
                data: idfData[rp].sort((a, b) => a.x - b.x),
                borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                fill: false,
            }));

            new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    scales: {
                        x: { type: 'logarithmic', title: { display: true, text: 'Duration (minutes)' } },
                        y: { type: 'logarithmic', title: { display: true, text: 'Rainfall Intensity (mm/h)' } }
                    }
                }
            });
        }
    </script>
</body>
</html>
